generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String       @id @default(cuid())
  email       String       @unique
  name        String
  picture     String
  gender      String?
  rollNo      String?      @unique
  phoneNo     String?
  teamId      String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  team        Team?        @relation("team", fields: [teamId], references: [id])
  Submission  Submission[]
  teamLeading Team?        @relation("teamLeader")
}

model Team {
  id                      String                    @id @default(cuid())
  name                    String
  teamLeaderId            String                    @unique
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  points                  Int                       @default(0)
  teamLeader              User                      @relation("teamLeader", fields: [teamLeaderId], references: [id])
  QuestionGroupSubmission QuestionGroupSubmission[]
  Submission              Submission[]
  members                 User[]                    @relation("team")
}

model Question {
  seq             Int
  title           String
  description     String
  answer          String
  pointsAwarded   Int
  questionGroupId String
  QuestionGroup   QuestionGroup @relation(fields: [questionGroupId], references: [id])
  Submission      Submission[]

  @@id([seq, questionGroupId])
}

model QuestionGroup {
  id                      String                    @id @default(cuid())
  name                    String
  description             String
  numQuestion             Int
  isSequence              Boolean
  questions               Question[]
  QuestionGroupSubmission QuestionGroupSubmission[]
}

model Submission {
  id              String   @id @default(cuid())
  userId          String
  questionSeq     Int
  questionGroupId String
  teamId          String
  answer          String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  isCorrect       Boolean
  question        Question @relation(fields: [questionSeq, questionGroupId], references: [seq, questionGroupId])
  team            Team     @relation(fields: [teamId], references: [id])
  user            User     @relation(fields: [userId], references: [id])

  @@unique([teamId, questionSeq, questionGroupId])
}

model QuestionGroupSubmission {
  teamId                String
  questionGroupId       String
  numQuestionsCompleted Int           @default(0)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  questionGroup         QuestionGroup @relation(fields: [questionGroupId], references: [id])
  team                  Team          @relation(fields: [teamId], references: [id])

  @@id([teamId, questionGroupId])
}
